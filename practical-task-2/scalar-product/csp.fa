#define VECTOR_PART_SIZE 1000
#define PARTS_COUNT 10

import init_vector_part(
    int vector_id,
    int part_number,
    int part_size,
    name vector
) as init_vector_part;

import print_result(real n) as print_result;

import smulv2_part(
    value x,
    value y,
    name z,
    int part_size
) as smulv2_part;

import init(name x, real val) as init;


sub mulv(name x, name y, name z) {
    for i = 0 .. $PARTS_COUNT-1
        smulv2_part(x[i], y[i], z[i], $VECTOR_PART_SIZE);
}


sub reduce_sum(name arr, int begin, int end, name result) {
    if (end - begin == 1) {
        init(result, arr[begin]);
    }

    if (end - begin > 1) {
        df tmp1, tmp2;
        reduce_sum(
            arr,
            begin,
            begin + (end - begin) / 2,
            tmp1
        );
        reduce_sum(
            arr,
            begin + (end - begin) / 2,
            end,
            tmp2
        );
        init(result, tmp1 + tmp2);
    }
}


sub main() {
    df x, y, z, result;

    for i = 0 .. $PARTS_COUNT-1 {
        init_vector_part(
            0,
            i,
            $VECTOR_PART_SIZE,
            x[i]
        );
        init_vector_part(
            1,
            i,
            $VECTOR_PART_SIZE,
            y[i]
        );
    }

    mulv(x, y, z);
    reduce_sum(z, 0, $PARTS_COUNT, result);
    print_result(result);
}
